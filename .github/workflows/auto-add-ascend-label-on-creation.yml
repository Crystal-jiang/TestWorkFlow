name: Auto-Add "ascend" Label on Creation
on:
  issues:
    types: [opened]

permissions:
  issues: write

jobs:
  add_ascend_label:
    runs-on: ubuntu-latest
    steps:
      - name: Add Ascend Label on Creation
        uses: actions/github-script@v7
        with:
          script: |
            try {
              // 1. Extract relevant data
              const title = context.payload.issue.title.toLowerCase()
              const body = context.payload.issue.body?.toLowerCase() || '';

              const owner = context.repo.owner;
              const repo = context.repo.repo;
              const number = context.payload.issue.number;

              const content = `${title} ${body}`;
            
              // 2. Check if the content contains the keyword "ascend"
              if (!content.includes('ascend')) {
                console.log('No "ascend" keyword found in title/body. Skipping.');
                return;
              }

              // 3. Fetch the current issue/pr to check existing lables
              const labelsResponse = await github.rest.issues.listLabelsOnIssue({
                owner: owner,
                repo: repo,
                issue_number: number,
              });
                          
              // 4. Avoid duplicate label addition
              const existingLabels = labelsResponse.data?.map(label => label.name) || [];
              if (existingLabels.includes('ascend')) {
                console.log('Label "ascend" already exists. Skipping.');
                return;
              }
            
              // 5. Add the "ascend" label
              await github.rest.issues.addLabels({
                owner: owner,
                repo: repo,
                issue_number: number,
                labels: ['ascend']
              });
              console.log('Successfully added "ascend" label.');
            } catch (error) {
                console.error('Error adding label:', error);
            }
